{
  "hash": "c6b9e4c92837b37e83e8c297f757497a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Helper Functions\"\nformat:\n  html:\n    toc: true\n    toc-expansion: true\n    fig-height: 3\n---\n\n\n::: {.cell}\n\n:::\n\n\nTranslating survival models to quantities of interest (such as survival curves) can be cumbersome. While the exercise is worth doing once, students have suggested that it would be helpful to have functions that could carry out some of the steps automatically. Below are two functions that we use in the class to bundle these steps.\n\n## `viz_survreg`: Visualize a `survreg` model\n\nThe [`viz_survreg`](assets/viz_survreg.R) function visualizes a survival model estimated with the `survreg` function.\n\n* The argument `x` is a fitted model object of class `survreg`\n* The function prints a `ggplot` object with estiamted hazard and survival curves\n\nCurrently, this function only supports `survreg` models with `dist = \"weibull\"`, `dist = \"exponential\"`, or `dist = \"lognormal\"`. It will plot the estimated curves at the minimum, median, and maximum values of the linear predictor $\\vec{X}'\\hat{\\vec\\beta}$.\n\nYou can click [`viz_survreg`](assets/viz_survreg.R) to see the source code. You can load this function with.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"https://ilundberg.github.io/eventhistory/assets/viz_survreg.R\")\n```\n:::\n\n\n::: {.cell}\n\n:::\n\n\nTo illustrate this function, the code below loads the `first_marriage_duration` data,\n\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfirst_marriage_duration <- read_csv(\"https://ilundberg.github.io/eventhistory/assets/first_marriage_duration.csv\")\n```\n:::\n\n\nestimates a Weibull survival model,\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweibull_model <- survreg(\n  Surv(time, event = 1 - censored) ~ 1,\n  data = first_marriage_duration,\n  dist = \"weibull\"\n)\n```\n:::\n\n\nand then visualizes the estimated model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nviz_survreg(weibull_model)\n```\n\n::: {.cell-output-display}\n![](helper_functions_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## `km_compare`: Compare to Kaplan-Meier\n\nThe [`km_compare`](assets/km_compare.R) function compares model-based survival estimates to nonparametric Kaplan-Meier estimates.\n\n* The argument `x` is a fitted model object of class `survreg`\n* The optional argument `subgroup_rows` is a numeric vector with the indices of cases from the fitted model object where you seek to make predictions.\n     * If provided, the function will compare a Kaplan-Meier curve on this subgroup to the model-based predicted survival curve averaged over this subgroup.\n     * If not provided, the function will compare a Kaplan-Meier curve on the full data to the model-bsaed predictions averaged over the full data.\n* The function prints a `ggplot` object with estiamted hazard and survival curves\n\nCurrently, this function only supports `survreg` models with `dist = \"weibull\"`, `dist = \"exponential\"`, or `dist = \"lognormal\"`.\n\nYou can click [`km_compare`](assets/km_compare.R) to see the source code. You can load this function with.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"https://ilundberg.github.io/eventhistory/assets/km_compare.R\")\n```\n:::\n\n\n::: {.cell}\n\n:::\n\n\nTo illustrate this function, the code below loads the `first_marriage_duration` data,\n\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfirst_marriage_duration <- read_csv(\"https://ilundberg.github.io/eventhistory/assets/first_marriage_duration.csv\")\n```\n:::\n\n\nestimates a Weibull survival model,\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweibull_model <- survreg(\n  Surv(time, event = 1 - censored) ~ 1,\n  data = first_marriage_duration,\n  dist = \"weibull\"\n)\n```\n:::\n\n\nand then visualizes the Kaplan-Meier comparison with the helper function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkm_compare(weibull_model)\n```\n\n::: {.cell-output-display}\n![](helper_functions_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "helper_functions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}