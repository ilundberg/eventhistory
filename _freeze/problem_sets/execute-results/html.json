{
  "hash": "3ac209998bdaf8deb7c5e62c7f38cf8c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Problem Sets\"\nformat: html\n---\n\n\n::: {.cell}\n\n:::\n\n\nProblem sets are currently posted on Piazza, but I plan to gather them on this page.\n\n## Problem Set 1: Key Concepts\n\nA study enrolls 6 people looking for work. 3 are randomly assigned to a job training intervention and 3 are randomly assigned to no job training. Over a 52-week follow-up period beginning January 1, the study records the time until they are hired in weeks.\n\n\n| ID | Age | Treatment | Time until hired |\n| --- | --- | --- | --- |\n1 | 53 | Treated | 12 weeks |\n2 | 26 | Treated | 10 weeks  |\n3 | 37 | Treated | 44 weeks |\n4 | 25 | Untreated | 7 weeks |\n5 | 48 | Untreated | Never hired in 52 weeks |\n6 | 34 | Untreated | 40 weeks |\n\n1. What is time 0 in this study?\n2. Which unit(s) were censored?\n3. Can you point identify the mean time until hired in the treatment condition? If not, can you provide a lower bound? Ignore statistical uncertainty.\n4. Can you point identify the mean time until hired in the untreated condition? If not, can you provide a lower bound? Ignore statistical uncertainty.\n5. Does the job training reduce the average time until hired?\n\nThe next questions are about the Exponential distribution, which assumes a constant hazard: $h(t) = \\lambda$.\n\n6. True or False. The CDF $F(t) = P(T < t)$ is an increasing function of $t$.\n7. True or False. The survival function $S(t) = P(T > t)$ is an increasing function of $t$.\n8. A demographer studies a cohort of people born in 1965 where age is the time variable (with time zero at age zero). They study the time until first marriage. In 1--3 sentences, make an argument that the assumption of a constant hazard is implausible.\n\n## Problem Set 2: Exponential\n\nSee the [exercise](exponential.qmd#exercise) at the end of the Exponential page.\n\n## Problem Set 3: Weibull\n\nThis problem set practices Kaplan-Meier survival curve estimation and a Weibull model.\n\nThe `survival::veteran` data contain data from a clinical trial involving cancer patients run by the Veteran's Administration. These data are described in Kalbfleisch and Prentice (1980) on p.~60. There are 137 patients, and only 9 are censored before death. \n\n- `status` is 1 for death, 0 for censoring\n- `time` is days of survival\n- `trt` is a randomized chemotherapy test treatment. 1 indicates standard treatment, 2 indicates the test treatment\n\nFor more information on the data see `?survival::veteran`.\n\n1. (10 points) Estimate survival curves by treatment status `trt`, using the Kaplan-Meier method. Visualize the results in a plot.\n2. (10 points) Estimate survival curves by treatment status `trt`, using a Weibull regression with only this predictor. Visualize the results in a plot.\n3. (10 points) Compare: Plot the Weibull and Kaplan-Meier survival curves on the same plot. How do they differ? For ease of comparison, you might use different panels or different plots for each treatment status so that it is easier to compare across models within treatment status.\n4. (10 points) Plot the estimated Weibull hazard function. Does it increase or decrease with time?\n5. (8 points) In your Weibull results, can you reject the null of an Exponential model?\n6. (2 points, Challenge): Construct a confidence interval on each point of your Weibull survival functions and visualize the result. Note that this is quite challenging; it is only worth 2 points so that you can skip it and still get an A on the problem set. Here are some steps.\n     - Define the X matrix at which to make predictions\n     - Loop over simulations. In each iteration,\n          - Simulate $\\vec\\beta$ and the `log_scale` parameter from a Multivariate Normal centered at `c(coef(model), log(model$scale))` with variance-covariance matrix `vcov(model)`\n          - Calculate the simulated value of the `rweibull` parameter `scale`, which is $e^{\\vec{X}'\\vec\\beta}$ where $\\vec\\beta$ are coefficients from `survreg`\n          - Calculate the simulated value of the `rweibull` parameter `shape`, which is `1 / exp(log_scale)` where `log_scale` is the simulated value of the log of what `survreg` calls the scale parameter\n          - Simulate survival functions with those parameters\n     - At each point of the survival curve, calculate the 2.5 and 97.5 percentiles of the empirical distribution of simulated draws.\n\n## Problem Set 4: Recap of Survival Analysis\n\nThis problem set asks you to carry out a survival analysis of your choosing using concepts we have learned in the course. Choose one of the NLSY datasets on the [data](data.qmd) page, which include\n\n* [nlsy_outcomes.csv](assets/nlsy_outcomes.csv) which contains time to high school completion, college completion, marriage, and parenthood with a few basic covariates\n     * In this dataset, you would likely choose 1 of the 4 outcomes\n* [employment_duration.csv](assets/employment_duration.csv) which contains the duration of spells of employment, with many covariates defined at the start of the spell\n* [first_marriage_duration.csv](assets/first_marriage_duration.csv) which contains the duration of first marriages, with many covariates defined at the start of the spell\n\nBelow are the questions for the problem set.\n\n1. Define time 0, time to event, and censoring for your question.\n2. Visualize survival with Kaplan-Meier. Interpret something about the estimated curve.\n3. Using one or more covariates and a model with a parametric hazard, compare survival curves across subgroups.\n     * Explain why you made your particular modeling choices.\n4. In words, give an example of non-ignorable censoring that could exist in your setting.\n5. In words, give an example of unmeasured heterogeneity that could exist in your setting. How might this affect the estimated hazard function?\n\n## Problem Set 5: Causal Effect on Survival\n\nThe file `employment_duration.csv` contains information on spells of employment.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemployment_duration <- read_csv(\"https://ilundberg.github.io/eventhistory/assets/employment_duration.csv\")\n```\n:::\n\n\n::: {.cell}\n\n:::\n\n\nAt the start of each employment spell, we observe whether the respondent works `fulltime = TRUE` or `fulltime = FALSE`, where `fulltime` is an indicator of working 40+ hours in at least one week during the first month of the job. This problem set considers a causal question: to what degree does being employed full-time at the start affect the length of the employment spell?\n\nWe will make the simplifying assumptions of ignorable censoring and that selection on observables holds conditional on the following confounder set: `race`, `sex`, `age`, and `education`.\n\nAs context, below are the descriptive Kaplan-Meier survival curves by full-time status (with no confounder adjustment). \n\n::: {.cell}\n::: {.cell-output-display}\n![](problem_sets_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nAs a concrete data point, the probability of remaining employed for 5 years among those in each treatment group is given below. There is approximately an 8 percentage point difference across treatment conditions.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 Ã— 2\n# Groups:   Treatment_Value [2]\n  Treatment_Value Survives_5_Years\n  <chr>                      <dbl>\n1 fulltime=FALSE             0.154\n2 fulltime=TRUE              0.231\n```\n\n\n:::\n:::\n\n\n1. Estimate a Weibull model for employment duration as a function of the treatment `fulltime` and the confounders `race`, `sex`, `age`, and `education`.\n\n2. Create two new data frames to make predictions. Each begins as `employment_duration`. In the first data frame, set `fulltime = TRUE` for all cases. In the second data frame, set `fulltime = FALSE` for all cases.\n\n3. In each data frame, use your model to predict the probability of surviving (remaining in the employment spell) for at least 5 years, for every person in the data frame.\n\n4. Take the average of the predicted probabilities. These are estimates of $\\text{P}(Y^{\\text{fulltime} = \\text{TRUE}} > 5)$ and $\\text{P}(Y^{\\text{fulltime} = \\text{FALSE}} > 5)$. Report each estimate and the difference between them, which is your estimated causal effect. How does it compare to the 8 percentage point descriptive difference?\n\n**Note.** This is not part of the assignment because we have already practiced it previously, but worth noting. You can imagine running a loop over many time points and then creating counterfactual survival curves for the population-average survival in each counterfactual scenario. The problem set just chose one time point (time = 5) for illustration.\n\n## Problem Set 6: Longitudinal Treatments\n\nA researcher wants to know the expected potential outcome $\\text{E}(Y^{a_0,a_1})$ under an intervention to set $A_0 = a_0$ and $A_1 = a_1$. Assume that variables named $A,L,Y$ are observed but variables named $U$ are unobserved.\n\n1. In which of settings A--D can this causal estimand be identified using the simple mean $\\text{E}(Y\\mid A_0 = a_0, A_1 = a_1)$?\n2. In which of settings A--D can this causal estimand be identified using inverse probability weights applied in a marginal structural model, adjusting at each period for the observed past?\n\n![](assets/dynamic_settings.png)\n\n3. Now focus on Setting D. For Setting D, explain how $L_1$ complicates the quest to identify the effect of $A_0$ and the effect of $A_1$ with the same adjustment set for both effects.\n\nThe next part practices estimating a marginal structural model in a dynamic setting designed to be as simple as possible.\n\nSuppose a teacher observes students who are struggling academically ($L_t = 1$) or not ($L_t = 0)$ in every time period $t$. The teacher can assign students to receive extra support ($A_t = 1$) or not ($A_t = 0$). The outcome $Y$ is a subsequent measure of skills (e.g., can the student read a picture book to the teacher). The data [pset6.csv](assets/pset6.csv) contains a simulated setting with $n = 128$ students.\n\nIn this data generating process,\n\n- Treatment $A_t = 1$ is assigned with higher probabilities to students who are struggling $L_t = 0$.\n- Students who are treated in one period $A_0 = 1$ are never struggling in the next period $L_1 = 0$.\n\nAssume the causal structure represented by Setting D above. Using these data,\n\n4. Fit a logistic regression for each $A_t$, including as predictors all pre-treatment variables entered without interactions.\n5. Predict the probability of $A_t = 1$ at each time period for every unit. Remember that in R you will need the \\texttt{type = \"response\"} option. For grading, what is the predicted probability of $A_0$ for the first unit in the sample?\n6.  Define the generalized propensity score $\\pi_{it}$ at each time period $t$ for each unit $i$. When $A_{it}$ \n7. Define a weight for each unit: $w_i = \\frac{1}{\\pi_{i0}}\\frac{1}{\\pi_{i1}}$. For grading, what is the weight on the first unit in the sample?\n8. Estimate a marginal structural model of the form $\\text{E}(Y^{a_0,a_1}) = \\alpha + \\beta_0 a_0 + \\beta_1 a_1$. Report the coefficients.\n9. What does your model estimate for the average causal effect $\\text{E}(Y^{1,1} - Y^{0,0})$?\n",
    "supporting": [
      "problem_sets_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}