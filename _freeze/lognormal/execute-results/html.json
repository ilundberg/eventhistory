{
  "hash": "e6685fe549c51cb54d328a860d8fd9b2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lognormal\"\nformat:\n  html:\n    toc: true\n    toc-expansion: true\n    fig-height: 3\n---\n\nIf $Z$ follows a Normal distribution, then $Y \\sim \\exp(Z)$ follows a Lognormal distribution (since then $\\log(Y)$ follows a Normal distribution). The Lognormal can be used in survival analysis because it is defined on non-negative numbers. In fact, it is a common choice for modeling human mortality.\n\nThe Lognormal distribution is characterized by two parameters: `meanlog` and `sdlog`, which correspond to the mean and standard deviation of the log survival time. These two parameters can define many possible curves.\n\n\n::: {.cell}\n\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](lognormal_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Data\n\nOn this page, we will explore the lognormal to model mortality in the [deaths.csv](assets/deaths.csv) data, which I simulated from 2023 age-specific mortality rates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths <- read_csv(\"https://ilundberg.github.io/eventhistory/assets/deaths.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\nThe time variable is `age` and in these data every unit experiences the event (`died = 1` in every row).\n\n### Estimate\n\nWe can fit a Lognormal model using the `survreg` function, as with other distributions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlognormal_model <- survreg(\n  Surv(age, event = died) ~ 1,\n  data = deaths,\n  dist = \"lognormal\"\n)\n```\n:::\n\n\n### Predict parameters\n\nIn this model, the mean of the log of $Y$ is modeled by the linear predictor $\\text{E}(\\log(Y)\\mid\\vec{X} = \\vec{x}) = \\vec{x}'\\vec\\beta$ and the standard deviation of the log of $Y$, $\\text{SD}(\\log(Y)\\mid\\vec{X})$ is the scale parameter `lognormal_model$scale` which is assumed by the model to be the same at all values of $\\vec{X}$ (as in homoskedastic linear regression).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeanlog <- predict(lognormal_model, type = \"linear\")\nsdlog <- lognormal_model$scale\n```\n:::\n\n\n### Predict hazard and survival\n\nYou can use the `plnorm`, `dlnorm`, and `qlnorm` functions to simulate quantities of interest given `meanlog` and `sdlog`. The process is analogous to previous models we have learned. For simplicity, here we use the [`viz_survreg()`](assets/viz_survreg.R) function that I wrote.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"https://ilundberg.github.io/eventhistory/assets/viz_survreg.R\")\n```\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlognormal_model |> viz_survreg()\n```\n\n::: {.cell-output-display}\n![](lognormal_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nNearly everyone survives at younger ages, and then people gradually die at older ages.\n\nWe can also compare the fit to a Kaplan-Meier curve to assess the validity of the parametric assumptions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"https://ilundberg.github.io/eventhistory/assets/km_compare.R\")\n```\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlognormal_model |> km_compare()\n```\n\n::: {.cell-output-display}\n![](lognormal_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nIn this case the fit is not that perfect: the model underestimates survival at roughly ages 50--80 and overestimates survival after age 80. On the next page, we will get a closer fit with a piecewise Exponential model.\n",
    "supporting": [
      "lognormal_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}